<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GSC Response Form</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #74ebd5, #ACB6E5);
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .form-container {
      background: white;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    h2 {
      text-align: center;
      margin-bottom: 24px;
      color: #333;
      font-size: 24px;
    }

    .name-fields {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 16px;
    }

    .name-fields input {
      width: 48%;
    }

    input, textarea {
      width: 100%;
      padding: 12px 16px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    input:focus, textarea:focus {
      border-color: #74ebd5;
      outline: none;
    }

    textarea {
      resize: vertical;
      font-family: monospace;
      white-space: pre-wrap;
    }

    .question-textarea {
      background: #f9f9f9;
      height: 250px;
    }

    .answer-textarea {
      height: 250px;
    }

    button {
      width: 48%;
      padding: 12px;
      background: #5c6bc0;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 12px;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #3f51b5;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    #saved-message {
      font-size: 14px;
      color: #333;
      text-align: right;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div class="form-container">
    <h2>GSC Response Form</h2>

    <form id="gsc-form">
      <div class="name-fields">
        <input id="firstname" type="text" placeholder="First Name" required />
        <input id="lastname" type="text" placeholder="Last Name" required />
      </div>

      <label for="question-display"><strong>Question</strong></label>
      <textarea id="question-display" class="question-textarea" readonly>
Dear Applicant:

Please read the instructions below and complete the 4-part assignment:

PART I - Enclosed you will find a Study Summary describing a fictional clinical trial investigating the efficacy and safety of an antidepressant drug, genoxyl, in a geriatric population. Your target reader needs a concise overview of the study.

Write a structured abstract (Objectives, Methods, Results, and Conclusion) based on the Study Summary. Your abstract should be structured with appropriate subheadings, should use complete sentences (not phrases as some journals allow), and should be approximately 300 words. List the word count at the end of your abstract.
      </textarea>

      <label for="question1"><strong>Your Answer (Auto-cleaned LaTeX)</strong></label>
      <textarea id="question1" class="answer-textarea" placeholder="Paste or type LaTeX formula here..." required></textarea>

      <div class="button-group">
        <button type="button" id="save-btn">Save</button>
        <button type="submit">Submit</button>
      </div>

      <div id="saved-message"></div>
    </form>
  </div>

  <script>
    function cleanLatex(raw) {
      return raw
        .replace(/^{\\?displaystyle\s*/, '') // Remove leading {\displaystyle
        .replace(/\\begin{aligned}|\\end{aligned}/g, '') // Remove \begin{aligned}
        .replace(/^\{+|\}+$/g, '') // Strip outer {}
        .replace(/\\\\/g, '\\') // Double backslashes to single
        .replace(/[\r\n]+/g, ' ') // Replace line breaks with space
        .replace(/\s+/g, ' ') // Normalize whitespace
        .replace(/\s*\\\]$/, '') // Remove trailing \]
        .replace(/^\\\[\s*/, '') // Remove leading \[
        .trim(); // Final cleanup
    }

    const textarea = document.getElementById('question1');

    textarea.addEventListener('input', () => {
      const original = textarea.value;
      const cleaned = cleanLatex(original);
      if (cleaned && original !== `\\[${cleaned}\\]`) {
        textarea.value = `\\[${cleaned}\\]`;
      }
    });

    // Save/Load/Submit logic (optional)
    document.getElementById("save-btn").addEventListener("click", () => {
      localStorage.setItem("firstname", document.getElementById("firstname").value);
      localStorage.setItem("lastname", document.getElementById("lastname").value);
      localStorage.setItem("question1", document.getElementById("question1").value);
      localStorage.setItem("savedTime", new Date().toLocaleString());
      document.getElementById("saved-message").textContent = "Draft last saved on: " + new Date().toLocaleString();
      alert("Draft saved locally!");
    });

    document.getElementById("gsc-form").addEventListener("submit", (e) => {
      e.preventDefault();
      alert("Submitted (you can integrate Supabase here)");
    });

    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("firstname").value = localStorage.getItem("firstname") || "";
      document.getElementById("lastname").value = localStorage.getItem("lastname") || "";
      document.getElementById("question1").value = localStorage.getItem("question1") || "";
      document.getElementById("saved-message").textContent =
        localStorage.getItem("savedTime")
          ? "Draft last saved on: " + localStorage.getItem("savedTime")
          : "";
    });
  </script>
</body>
</html>
